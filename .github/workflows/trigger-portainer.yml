name: Trigger Portainer Webhook

on:
  workflow_call:
    inputs:
      portainer_webhook_url:
        required: true
        type: string
    secrets:
      portainer_cf_client_id:
        required: true
      portainer_cf_client_secret:
        required: true

jobs:
  trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Call Portainer Webhook
        run: |
          echo "ğŸ”„ WywoÅ‚ujÄ™ webhook: ${{ inputs.portainer_webhook_url }}"

          RESPONSE=$(curl -s -D - -o /tmp/output.html -w "%{http_code}" \
            -X POST "${{ inputs.portainer_webhook_url }}" \
            -H "CF-Access-Client-Id: ${{ secrets.portainer_cf_client_id }}" \
            -H "CF-Access-Client-Secret: ${{ secrets.portainer_cf_client_secret }}" \
          )

          echo "ğŸ“¥ HTTP status: $RESPONSE"
          echo "ğŸ“¥ Body:"
          cat /tmp/output.html

          if [[ "$RESPONSE" -lt 200 || "$RESPONSE" -ge 300 ]]; then
            echo "âŒ Webhook failed with HTTP status $RESPONSE"
            exit 1
          fi
